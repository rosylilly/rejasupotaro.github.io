<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Rejasupoem</title>
  <subtitle>deliver value to customers continuously or die;</subtitle>
  <id>http://rejasupotaro.github.io/</id>
  <link href="http://rejasupotaro.github.io/"/>
  <link href="http://rejasupotaro.github.io/feed.xml" rel="self"/>
  <updated>2014-02-22T00:00:00+09:00</updated>
  <author>
    <name>rejasupotaro</name>
  </author>
  <entry>
    <title>自動でAndroid SDKをセットアップする</title>
    <link rel="alternate" href="http://rejasupotaro.github.io/2014/02/22/40.html"/>
    <id>http://rejasupotaro.github.io/2014/02/22/40.html</id>
    <published>2014-02-22T00:00:00+09:00</published>
    <updated>2014-02-24T14:17:25+09:00</updated>
    <author>
      <name>rejasupotaro</name>
    </author>
    <content type="html">&lt;p&gt;新しくプロジェクトを触るとき、とりあえずimportしてビルドでエラー出てあーそのバージョン入ってなかったな入れるかみたいなことをすることあるけど、&lt;/p&gt;

&lt;pre&gt;&lt;code class="groovy"&gt;android {
    compileSdkVersion 18
    buildToolsVersion &amp;quot;19.0.1&amp;quot;

    ...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;こうやってビルドファイルにはプロジェクトが必要としているSDKとかビルドツールは書いてるので、この設定をみてインストールしてなかったら自動で入れてくれたら便利そうと思って作りました。&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/rejasupotaro/sdk_manager"&gt;rejasupotaro / sdk_manager&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;使い方は、どこかでapplyして、&lt;/p&gt;

&lt;pre&gt;&lt;code class="groovy"&gt;apply from: &amp;#39;https://raw2.github.com/rejasupotaro/gradle-android-sdk-manager/master/sdk_manager.gradle&amp;#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;※リポジトリの参照先を変えました！&lt;a href="https://github.com/cookpad/gradle-android-sdk-manager"&gt;こちら&lt;/a&gt;を参照するようにしてください！&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;一行メソッドを追加するだけです。&lt;/p&gt;

&lt;pre&gt;&lt;code class="groovy"&gt;android {
    compileSdkVersion 18
    buildToolsVersion &amp;quot;19.0.1&amp;quot;

    installRequiredSdk(android)

    ...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;並列でインストールするので普通より早いです。&lt;/p&gt;

&lt;p&gt;Androidのツール書くときRubyとかGoとかHaskellとかも考えるけど、もちろんビルドファイルがGroovyだからってのもあるけど、相性抜きにしても表現力が高くて並列処理とかもめちゃめちゃ簡単に書けて、JVM最高みたいになってる。&lt;/p&gt;

&lt;pre&gt;&lt;code class="groovy"&gt;-buildComponents(sdkDir, compileSdkVersion, buildToolsVersion).each {
-    runInstall(sdkDir, it)
+def workers = []
+buildComponents(sdkDir, compileSdkVersion, buildToolsVersion).each { component -&gt;
+    workers.add(Thread.start{ runInstall(sdkDir, component) })
 }
+workers*.join()
&lt;/code&gt;&lt;/pre&gt;
</content>
  </entry>
  <entry>
    <title>Androidのiframeのイベントハンドリング</title>
    <link rel="alternate" href="http://rejasupotaro.github.io/2014/02/20/39.html"/>
    <id>http://rejasupotaro.github.io/2014/02/20/39.html</id>
    <published>2014-02-20T00:00:00+09:00</published>
    <updated>2014-02-20T08:45:52+09:00</updated>
    <author>
      <name>rejasupotaro</name>
    </author>
    <content type="html">&lt;h1&gt;iframeの広告を配信する？&lt;/h1&gt;

&lt;p&gt;AndroidにAdMobでiframeの広告を配信したいという話があって、あれWebViewでiframeのイベントって拾えるんだっけ？っていう話になりました。
パッと調べたところ、iOSのshouldStartLoadWithRequestはiframeのイベントでも呼ばれますが、AndroidのshouldOverrideUrlLoadingは呼ばれないらしいということが分かりました。&lt;/p&gt;

&lt;p&gt;まあ、広告自体はiframeを使うとレギュレーション違反で、最悪アカウントごと消される可能性があるってことでなくなったのですが、ちょっと別の事情もありiframeのイベントのハンドリングについて調べることになりました。&lt;/p&gt;

&lt;h1&gt;別の事情&lt;/h1&gt;

&lt;p&gt;個人的にRebuild.fm for Androidというアプリをオープンソースで開発しているのですが、Twitterの検索結果の表示を本来ならばネイティブ実装するところを横着して、WebView + Twitter Widgetにしたところ、画面遷移で真っ白になってしまい(表示できるページもある)、とりあえずリンクをタップしたら外部アプリに遷移させたかった。全部雪のせいだ。&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/timeline1.png" alt=""&gt;&lt;/p&gt;

&lt;h1&gt;AndroidのWebViewのイベントのコールの順番&lt;/h1&gt;

&lt;ol&gt;
&lt;li&gt;loadUrl (URLを指定して読み込みを開始する。)&lt;/li&gt;
&lt;li&gt;onPageStarted (ページの読み込み前に呼ばれる。)&lt;/li&gt;
&lt;li&gt;shouldOverrideUrlLoading (ページ遷移前に呼ばれる。)&lt;/li&gt;
&lt;li&gt;onReceivedError (エラーが発生したら呼ばれる。)&lt;/li&gt;
&lt;li&gt;onPageFinished (ページ読み込み完了時に呼ばれる。)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;iframe内でリンクをタップしたら…何も呼ばれないんですね。&lt;/p&gt;

&lt;h1&gt;iframeのイベントもハンドリングしたい&lt;/h1&gt;

&lt;p&gt;&lt;a href="http://developer.android.com/reference/android/webkit/WebViewClient.html"&gt;ドキュメント&lt;/a&gt;を見てたらshouldInterceptRequest (リソースを取りにいく前に呼ばれる)と、onLoadResource (リソースを受け取ったときに呼ばれる)(その割にファイルではなくWebViewを引数に受け取るので何に使うのかよく分からない)というメソッドを見つけました。この2つはiframeの中の読み込みでも呼ばれます。
shouldInterceptRequestはたとえばネットワークからリソースを取りにいく前にローカルに確認して、なければネットワークに取りにいく、ようなときに使います。
onLoadResourceは、何に使うといいんでしょうね。(読み込みが完了したときの処理はふつうonPageFinishedに書く)&lt;/p&gt;

&lt;h1&gt;ログを仕込んで実行してみる&lt;/h1&gt;

&lt;p&gt;メソッド名: URL で出力してみます。&lt;/p&gt;

&lt;h3&gt;初回の読み込み&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;shouldInterceptRequest: https://platform.twitter.com/widgets.js
onPageStarted: https://twitter.com/
onLoadResource: https://platform.twitter.com/widgets.js
onPageFinished: https://twitter.com/
shouldInterceptRequest: https://cdn.syndication.twimg.com/widgets/timelines/422550101425270784?domain=twitter.com&amp;amp;lang=en&amp;amp;t=1547578&amp;amp;callback=twttr.tfw.callbacks.tl_422550101425270784_1&amp;amp;suppress_response_codes=true
onLoadResource: https://cdn.syndication.twimg.com/widgets/timelines/422550101425270784?domain=twitter.com&amp;amp;lang=en&amp;amp;t=1547578&amp;amp;callback=twttr.tfw.callbacks.tl_422550101425270784_1&amp;amp;suppress_response_codes=true
shouldInterceptRequest: https://platform.twitter.com/embed/timeline.037a0cac0aa5abbe2c1b5c5cd368d398.2x.css
onLoadResource: https://platform.twitter.com/embed/timeline.037a0cac0aa5abbe2c1b5c5cd368d398.2x.css
shouldInterceptRequest: https://pbs.twimg.com/profile_images/2530067911/334DF298-F2E9-4F40-AADE-26304BE4BAB3_normal
onLoadResource: https://pbs.twimg.com/profile_images/2530067911/334DF298-F2E9-4F40-AADE-26304BE4BAB3_normal
shouldInterceptRequest: https://abs.twimg.com/sticky/default_profile_images/default_profile_0_normal.png
onLoadResource: https://abs.twimg.com/sticky/default_profile_images/default_profile_0_normal.png
shouldInterceptRequest: https://abs.twimg.com/sticky/default_profile_images/default_profile_0_bigger.png
onLoadResource: https://abs.twimg.com/sticky/default_profile_images/default_profile_0_bigger.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/435768971367702529/pklQQh0X_normal.png
onLoadResource: https://pbs.twimg.com/profile_images/435768971367702529/pklQQh0X_normal.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/417177784599851009/dtMUDHR8_normal.jpeg
onLoadResource: https://pbs.twimg.com/profile_images/417177784599851009/dtMUDHR8_normal.jpeg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1456750855/noplans_normal.png
onLoadResource: https://pbs.twimg.com/profile_images/1456750855/noplans_normal.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/642855612/ico_kutar2_normal.png
onLoadResource: https://pbs.twimg.com/profile_images/642855612/ico_kutar2_normal.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/378800000373060612/b7aa723e5a578d1bb140197c03572483_normal.jpeg
onLoadResource: https://pbs.twimg.com/profile_images/378800000373060612/b7aa723e5a578d1bb140197c03572483_normal.jpeg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/595802461/67309_490331167_normal.jpg
onLoadResource: https://pbs.twimg.com/profile_images/595802461/67309_490331167_normal.jpg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1478795301/icon_twitter_normal.jpg
onLoadResource: https://pbs.twimg.com/profile_images/1478795301/icon_twitter_normal.jpg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/3743606898/2f4e43525ec3ccba4d70c8320bf1db5a_normal.png
onLoadResource: https://pbs.twimg.com/profile_images/3743606898/2f4e43525ec3ccba4d70c8320bf1db5a_normal.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/3770844603/98341b299d5d310a45b1c58f216ef6dd_normal.jpeg
onLoadResource: https://pbs.twimg.com/profile_images/3770844603/98341b299d5d310a45b1c58f216ef6dd_normal.jpeg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1840775966/b_normal.PNG
onLoadResource: https://pbs.twimg.com/profile_images/1840775966/b_normal.PNG
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1300444117/hadaka2_normal.png
onLoadResource: https://pbs.twimg.com/profile_images/1300444117/hadaka2_normal.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/2530067911/334DF298-F2E9-4F40-AADE-26304BE4BAB3_bigger
onLoadResource: https://pbs.twimg.com/profile_images/2530067911/334DF298-F2E9-4F40-AADE-26304BE4BAB3_bigger
shouldInterceptRequest: https://pbs.twimg.com/profile_images/435768971367702529/pklQQh0X_bigger.png
onLoadResource: https://pbs.twimg.com/profile_images/435768971367702529/pklQQh0X_bigger.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/417177784599851009/dtMUDHR8_bigger.jpeg
onLoadResource: https://pbs.twimg.com/profile_images/417177784599851009/dtMUDHR8_bigger.jpeg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1456750855/noplans_bigger.png
onLoadResource: https://pbs.twimg.com/profile_images/1456750855/noplans_bigger.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/642855612/ico_kutar2_bigger.png
onLoadResource: https://pbs.twimg.com/profile_images/642855612/ico_kutar2_bigger.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/378800000373060612/b7aa723e5a578d1bb140197c03572483_bigger.jpeg
onLoadResource: https://pbs.twimg.com/profile_images/378800000373060612/b7aa723e5a578d1bb140197c03572483_bigger.jpeg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/595802461/67309_490331167_bigger.jpg
onLoadResource: https://pbs.twimg.com/profile_images/595802461/67309_490331167_bigger.jpg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1478795301/icon_twitter_bigger.jpg
onLoadResource: https://pbs.twimg.com/profile_images/1478795301/icon_twitter_bigger.jpg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/3743606898/2f4e43525ec3ccba4d70c8320bf1db5a_bigger.png
onLoadResource: https://pbs.twimg.com/profile_images/3743606898/2f4e43525ec3ccba4d70c8320bf1db5a_bigger.png
shouldInterceptRequest: https://pbs.twimg.com/profile_images/3770844603/98341b299d5d310a45b1c58f216ef6dd_bigger.jpeg
onLoadResource: https://pbs.twimg.com/profile_images/3770844603/98341b299d5d310a45b1c58f216ef6dd_bigger.jpeg
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1840775966/b_bigger.PNG
onLoadResource: https://pbs.twimg.com/profile_images/1840775966/b_bigger.PNG
shouldInterceptRequest: https://pbs.twimg.com/profile_images/1300444117/hadaka2_bigger.png
onLoadResource: https://pbs.twimg.com/profile_images/1300444117/hadaka2_bigger.png
shouldInterceptRequest: https://twitter.com/i/jot
onLoadResource: https://twitter.com/i/jot
shouldInterceptRequest: data:image/png;base64,iVBORw0K...
onLoadResource: data:image/png;base64,iVBORw0KGg...
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt;はてなブログのリンクをタップ&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;shouldInterceptRequest: https://twitter.com/i/jot?l=%7B%22_category_%22%3A%22tfw_client_event%22%2C%22widget_id%22%3A%22422550101425270784%22%2C%22widget_origin%22%3A%22https%3A%2F%2Ftwitter.com%2F%22%2C%22client_version%22%3A%221.0%22%2C%22query%22%3A%22rebuildfm%22%2C%22profile_id%22%3Anull%2C%22435950290265587712%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22435950722274709504%22%7D%2C%22format_version%22%3A1%2C%22dnt%22%3Afalse%2C%22triggered_on%22%3A1392823831585%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22element%22%3A%22url%22%2C%22component%22%3A%22tweet%22%2C%22section%22%3A%22stream%22%2C%22page%22%3A%22timeline%22%2C%22action%22%3A%22click%22%7D%7D
onLoadResource: https://twitter.com/i/jot?l=%7B%22_category_%22%3A%22tfw_client_event%22%2C%22widget_id%22%3A%22422550101425270784%22%2C%22widget_origin%22%3A%22https%3A%2F%2Ftwitter.com%2F%22%2C%22client_version%22%3A%221.0%22%2C%22query%22%3A%22rebuildfm%22%2C%22profile_id%22%3Anull%2C%22435950290265587712%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22435950722274709504%22%7D%2C%22format_version%22%3A1%2C%22dnt%22%3Afalse%2C%22triggered_on%22%3A1392823831585%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22element%22%3A%22url%22%2C%22component%22%3A%22tweet%22%2C%22section%22%3A%22stream%22%2C%22page%22%3A%22timeline%22%2C%22action%22%3A%22click%22%7D%7D
shouldInterceptRequest: http://t.co/HvfgJDxuBI
onLoadResource: http://t.co/HvfgJDxuBI
shouldInterceptRequest: http://gongo.hatenablog.com/entry/2014/02/18/232912
onLoadResource: http://gongo.hatenablog.com/entry/2014/02/18/232912
shouldInterceptRequest: https://syndication.twitter.com/widgets/timelines/paged/422550101425270784?domain=twitter.com&amp;amp;lang=en&amp;amp;since_id=436138958494265344&amp;amp;callback=twttr.tfw.callbacks.tlPoll_422550101425270784_1_436138958494265344&amp;amp;suppress_response_codes=true
&lt;/code&gt;&lt;/pre&gt;

&lt;h1&gt;ハッシュタグをタップ&lt;/h1&gt;

&lt;pre&gt;&lt;code&gt;shouldInterceptRequest: https://twitter.com/i/jot?l=%7B%22_category_%22%3A%22tfw_client_event%22%2C%22widget_id%22%3A%22422550101425270784%22%2C%22widget_origin%22%3A%22https%3A%2F%2Ftwitter.com%2F%22%2C%22client_version%22%3A%221.0%22%2C%22query%22%3A%22rebuildfm%22%2C%22profile_id%22%3Anull%2C%22436138432155234305%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22436138958494265344%22%7D%2C%22format_version%22%3A1%2C%22dnt%22%3Afalse%2C%22triggered_on%22%3A1392823972162%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22element%22%3A%22hashtag%22%2C%22component%22%3A%22tweet%22%2C%22section%22%3A%22stream%22%2C%22page%22%3A%22timeline%22%2C%22action%22%3A%22click%22%7D%7D
onLoadResource: https://twitter.com/i/jot?l=%7B%22_category_%22%3A%22tfw_client_event%22%2C%22widget_id%22%3A%22422550101425270784%22%2C%22widget_origin%22%3A%22https%3A%2F%2Ftwitter.com%2F%22%2C%22client_version%22%3A%221.0%22%2C%22query%22%3A%22rebuildfm%22%2C%22profile_id%22%3Anull%2C%22436138432155234305%22%3A%7B%22item_type%22%3A10%2C%22target_type%22%3A0%2C%22target_id%22%3A%22436138958494265344%22%7D%2C%22format_version%22%3A1%2C%22dnt%22%3Afalse%2C%22triggered_on%22%3A1392823972162%2C%22event_namespace%22%3A%7B%22client%22%3A%22tfw%22%2C%22element%22%3A%22hashtag%22%2C%22component%22%3A%22tweet%22%2C%22section%22%3A%22stream%22%2C%22page%22%3A%22timeline%22%2C%22action%22%3A%22click%22%7D%7D
shouldInterceptRequest: https://twitter.com/search?q=%23rebuildfm&amp;amp;src=hash
onLoadResource: https://twitter.com/search?q=%23rebuildfm&amp;amp;src=hash
shouldInterceptRequest: https://mobile.twitter.com/search
onLoadResource: https://mobile.twitter.com/search
&lt;/code&gt;&lt;/pre&gt;

&lt;h1&gt;iframeのイベントをどうハンドルするか&lt;/h1&gt;

&lt;p&gt;&lt;code&gt;url.startWith(&amp;quot;https://twitter.com/search&amp;quot;)&lt;/code&gt; とか、大雑把にURLを見てIntentを投げるようにしましたが、できることならiframeは使わない方がいいし、今回のケースだとネイティブで書いた方がいいです。&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/timeline2.png" alt=""&gt;&lt;/p&gt;

&lt;h1&gt;Links&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/6778080/android-webview-shouldoverrideurlloading-for-iframes?rq=1"&gt;Android webView shouldOverrideUrlLoading for iframes&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="http://stackoverflow.com/questions/16447437/android-webview-shouldoverrideurlloading-not-called-when-user-clicks-links?rq=1"&gt;Android - webview - shouldOverrideUrlLoading not called - when user clicks links inside iframe&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Rebuild.fmクライアント(非公式)開発の裏話</title>
    <link rel="alternate" href="http://rejasupotaro.github.io/2014/02/18/38.html"/>
    <id>http://rejasupotaro.github.io/2014/02/18/38.html</id>
    <published>2014-02-18T00:00:00+09:00</published>
    <updated>2014-02-20T08:50:16+09:00</updated>
    <author>
      <name>rejasupotaro</name>
    </author>
    <content type="html">&lt;p&gt;&lt;img src="https://raw2.github.com/rejasupotaro/Rebuild/master/screenshot.png" alt=""&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href="http://rejasupotaro.github.io/2014/02/17/37.html"&gt;Rebuild.fmクライアント(非公式)をリリースしました&lt;/a&gt;の開発の中で生まれたtipsや思い出を紹介しようと思います。
結構長いです。&lt;/p&gt;

&lt;h1&gt;目次&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;アプリのバージョニング&lt;/li&gt;
&lt;li&gt;RSSフィードの取得&lt;/li&gt;
&lt;li&gt;メディアの再生/停止ボタン&lt;/li&gt;
&lt;li&gt;Show Notesの表示&lt;/li&gt;
&lt;li&gt;MenuDeledate&lt;/li&gt;
&lt;li&gt;データの保存とテスト&lt;/li&gt;
&lt;li&gt;Tweetの取得&lt;/li&gt;
&lt;li&gt;FontAwesome&lt;/li&gt;
&lt;li&gt;通知の管理&lt;/li&gt;
&lt;li&gt;ライセンス表示&lt;/li&gt;
&lt;li&gt;進捗と開発のボトルネック&lt;/li&gt;
&lt;/ul&gt;

&lt;h1&gt;バージョニング&lt;/h1&gt;

&lt;p&gt;Android端末の設定からアプリ情報を見ると &amp;quot;バージョン0.1.2-SHA1&amp;quot; の形式になっていると思います。
Androidアプリのバージョンコードは整数でなければなりませんが、バージョン名は文字列なので、開発者が好きなように使うことができます。
たとえばビルドした日付を入れている開発者もいますし、独自に定義したコードを使っている人もいます。
僕の場合はオープンソースでやってるし、日付よりGitのログの方が有用かなと思って、このようにしました。&lt;/p&gt;

&lt;p&gt;というか思い立って調べたら&lt;a href="https://plus.google.com/+JakeWharton/posts/6f5TcVPRZij"&gt;Jake Wharton神の記事&lt;/a&gt;が出てきたので、ほぼそのとおりに設定しました。
以下、アプリのビルド設定の一部です。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;def versionMajor = 0
def versionMinor = 1
def versionPatch = 2
def versionBuild = 0 // bump for dogfood builds, public betas, etc.

def gitSha() {
    return &amp;#39;git rev-parse --short HEAD&amp;#39;.execute().text.trim()
}

android {
    compileSdkVersion 18
    buildToolsVersion &amp;quot;19.0.1&amp;quot;

    defaultConfig {
        minSdkVersion 14
        targetSdkVersion 18
        versionCode versionMajor * 10000 + versionMinor * 1000 + versionPatch * 100 + versionBuild
        versionName &amp;quot;${versionMajor}.${versionMinor}.${versionPatch}-${gitSha()}&amp;quot;
    }

    ...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;こんな感じで、バージョンコードとバージョンネームの生成はコードに任せています。&lt;/p&gt;

&lt;h1&gt;RSSフィードの取得&lt;/h1&gt;

&lt;p&gt;エピソードの取得ですが、アプリの起動時に&lt;a href="http://feeds.rebuild.fm/rebuildfm"&gt;Rebuild.fmのRSS&lt;/a&gt;を取得しています。
Androidで使えるRSSクライアントが見当たらなかったので、SAXParserを使って頑張ってparseしています。&lt;/p&gt;

&lt;p&gt;一応ライブラリにしました：&lt;a href="https://github.com/rejasupotaro/AsyncRssClient"&gt;rejasupotaro / AsyncRssClient&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;今思うとjsonicとgsonを使って、&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;before&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;url -&gt; [ xml -&gt; entity ] -&gt; entity
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;after&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code&gt;url, meta -&gt; [ xml -&gt; json -&gt; entity ] -&gt; entity
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;こうした方が良かったなと思いました。&lt;/p&gt;

&lt;h1&gt;メディアの再生/停止ボタン&lt;/h1&gt;

&lt;p&gt;最近&lt;a href="http://rejasupotaro.github.io/2014/02/09/35.html"&gt;別のアプリ&lt;/a&gt;でも再生/停止ボタンを作ったのですが、&lt;/p&gt;

&lt;p&gt;&lt;img src="https://github.com/rejasupotaro/KinMozaViewer/blob/master/screenshot.png?raw=true" alt=""&gt;&lt;/p&gt;

&lt;p&gt;2つのステートを持つImageViewは、CheckBoxを使うと簡単に実装できます。&lt;/p&gt;

&lt;h3&gt;media_start_and_pause_button.xml&lt;/h3&gt;

&lt;p&gt;まず、drawableにチェックされているときと、チェックされていないときの画像を定義します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;selector xmlns:android=&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;&amp;gt;
    &amp;lt;item
            android:state_checked=&amp;quot;true&amp;quot;
            android:drawable=&amp;quot;@android:drawable/ic_media_pause&amp;quot; /&amp;gt;
    &amp;lt;item
            android:state_checked=&amp;quot;false&amp;quot;
            android:drawable=&amp;quot;@android:drawable/ic_media_play&amp;quot; /&amp;gt;
&amp;lt;/selector&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt;style.xml&lt;/h3&gt;

&lt;p&gt;次に、Widget.CompoundButton.CheckBoxを継承したチェックボックスのスタイルを作って、drawableを上書きします。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;style name=&amp;quot;MediaStartAndPauseButton&amp;quot; parent=&amp;quot;android:Widget.CompoundButton.CheckBox&amp;quot;&amp;gt;
    &amp;lt;item name=&amp;quot;android:button&amp;quot;&amp;gt;@drawable/media_start_and_pause_button&amp;lt;/item&amp;gt;
    &amp;lt;item name=&amp;quot;android:layout_width&amp;quot;&amp;gt;wrap_content&amp;lt;/item&amp;gt;
    &amp;lt;item name=&amp;quot;android:layout_height&amp;quot;&amp;gt;wrap_content&amp;lt;/item&amp;gt;
&amp;lt;/style&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3&gt;FragmentのLayout&lt;/h3&gt;

&lt;p&gt;チェックボックスに定義したスタイルを適用します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;CheckBox
        android:id=&amp;quot;@+id/media_play_and_pause_button&amp;quot;
        style=&amp;quot;@style/MediaPlayAndPauseButton&amp;quot;
        android:layout_marginLeft=&amp;quot;@dimen/margin_icon_button&amp;quot;
        android:layout_gravity=&amp;quot;center&amp;quot;
        /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;こうすることでOn/Off時の画像の切り替えのコードを書かなくてよくなります。また、&lt;/p&gt;

&lt;pre&gt;&lt;code class="java"&gt;mMediaStartAndPauseButton.setOnCheckedChangeListener(
        new CompoundButton.OnCheckedChangeListener() {
            @Override
            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
                if (isChecked) {
                    start(episode);
                } else {
                    pause();
                }
            }
        });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;OnCheckedChangeListenerが使えたり、isCheckedメソッドが使えたりして、かなり具合がいいです。&lt;/p&gt;

&lt;h1&gt;Show Notesの表示&lt;/h1&gt;

&lt;p&gt;書いてる途中で寝てしまったのでうちに帰ってから書く。&lt;/p&gt;

&lt;h1&gt;MenuDeledate&lt;/h1&gt;

&lt;p&gt;書いてる途中で寝てしまったのでうちに帰ってから書く。&lt;/p&gt;

&lt;h1&gt;ActiveAndroidとRobotGirl&lt;/h1&gt;

&lt;p&gt;書いてる途中で寝てしまったのでうちに帰ってから書く。&lt;/p&gt;

&lt;h1&gt;TwitterWidgetの表示&lt;/h1&gt;

&lt;p&gt;&lt;a href="http://rejasupotaro.github.io/2014/02/20/39.html"&gt;書いてる途中で寝てしまったのでうちに帰ってから書く。&lt;/a&gt;&lt;/p&gt;

&lt;h1&gt;FontAwesome&lt;/h1&gt;

&lt;p&gt;書いてる途中で寝てしまったのでうちに帰ってから書く。&lt;/p&gt;

&lt;h1&gt;通知の管理&lt;/h1&gt;

&lt;p&gt;書いてる途中で寝てしまったのでうちに帰ってから書く。&lt;/p&gt;

&lt;h1&gt;ライセンス画面&lt;/h1&gt;

&lt;p&gt;書いてる途中で寝てしまったのでうちに帰ってから書く。&lt;/p&gt;

&lt;h1&gt;進捗と開発のボトルネック&lt;/h1&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/frequency.png" alt=""&gt;&lt;/p&gt;

&lt;p&gt;Code Frequencyをご覧のとおり、11月に着手してその一週間後に機能的にはほぼ完成していました。
そのあと忙しくなってあまり時間が取れずに2月のリリースになったのですが、何がそんな大変だったのかというと、UXとかUIを考えるのにすごく時間がかかりました。&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/episode_detail_fragment.png" alt=""&gt;&lt;/p&gt;

&lt;p&gt;XMLを書いては端末にインストールして確認し、場合によってはFragmentにしたりActivityに戻したりしながら進めてるので、すごく時間がかかっています。
チームで開発しているときは、各々が得意分野をやりますが、一人だと全部自分でしないといけないので、自分の弱点がそのまま開発のボトルネックになるということを実感しました。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;リポジトリはこちら：&lt;a href="https://github.com/rejasupotaro/Rebuild"&gt;rejasupotaro / Rebuild&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Rebuild.fmクライアント(非公式)をリリースしました</title>
    <link rel="alternate" href="http://rejasupotaro.github.io/2014/02/17/37.html"/>
    <id>http://rejasupotaro.github.io/2014/02/17/37.html</id>
    <published>2014-02-17T00:00:00+09:00</published>
    <updated>2014-02-18T09:22:37+09:00</updated>
    <author>
      <name>rejasupotaro</name>
    </author>
    <content type="html">&lt;h2&gt;Rebuild.fm for Android (Unofficial)&lt;/h2&gt;

&lt;p&gt;&lt;img src="https://raw2.github.com/rejasupotaro/Rebuild/master/screenshot.png" alt=""&gt;&lt;/p&gt;

&lt;p&gt;Rebuild.fm for Androidとは、&lt;a href="https://twitter.com/miyagawa"&gt;miyagawaさん&lt;/a&gt;のPodcast、&lt;a href="http://rebuild.fm/"&gt;Rebuild.fm&lt;/a&gt;専用のPodcastアプリです。&lt;/p&gt;

&lt;p&gt;このアプリ自体はオープンソースで開発していて、READMEにインストール手順は書いてあるのですが、あまり使ってくれる人がいませんでした。
開発するモチベーションを保つためにフィードバックが欲しくて、マーケットに出そうかなという話をmiyagawaさんにしたら快諾してくれたので、この度リリースしました。&lt;/p&gt;

&lt;p&gt;(本当は一周年記念に合わせてリリースしたかったけど、リリース準備してたら一部端末でOOMになるバグが見つかったりして間に合わなかった)&lt;/p&gt;

&lt;h2&gt;「Rebuild.fm専用？それって機能が限定されたPodcastアプリでは？」&lt;/h2&gt;

&lt;p&gt;よくあるPodcastアプリは無機質な感じで、よりRebuild.fmの世界観を表現したいと思ったからとか、twitterがテキストを140字に制限することで使いやすさを実現しているように、Rebuild.fmに限定することで使いたすくしたかった、という優等生的な回答をしつつ、実際のところは僕がPodcastはRebuild.fmしか聴いていなかったので、Rebuild.fmに特化した使いやすいアプリが欲しかったというのが一番の理由でした。&lt;/p&gt;

&lt;p&gt;使いやすさについて考えるために、僕とRebuild.fmの関わり方について考えました。&lt;/p&gt;

&lt;h2&gt;僕とRebuild.fm&lt;/h2&gt;

&lt;p&gt;「Rebuild.fmで言ってたけど、鳥はAndroidの方がやりやすいよね」とか「ほら、この前Rebuild.fmで言ってた〜」みたいに、エンジニアと話すとRebuild.fmが話題になったり、ブログとかイベントでネタにされていたりとか、あとは新しいエピソードが公開されたあと、みんなはどういう感想を持ったんだろうと思いながらtwitterでハッシュタグを追ったりとか、こういうことを図にしてみたら下のようになりました。&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/miyagawa.png" alt=""&gt;&lt;/p&gt;

&lt;p&gt;抽象的な図になってしまったのでもう少し分かりやすく説明すると、僕が小学生の頃には笑う犬の生活という番組が流行っていて、放送されると翌日に「見た？面白かったよね！」っていう話をみんなしてて、番組を見てると話の輪に入れるみたいな、そんな感じです。&lt;/p&gt;

&lt;h2&gt;Rebuild.fmアプリの見せ方&lt;/h2&gt;

&lt;p&gt;というわけで、Rebuild.fm本家の雰囲気を踏襲したデザインにしつつ、&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;エピソードに対する周りの人の反応をどう見せるか&lt;/li&gt;
&lt;li&gt;いかにしてエピソード内の情報を見やすくするか&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ということを考えて作りました。
考えて作ったというだけで、今のところ自分が納得できるクオリティになっているかというと、そうは思いません。
ですが、リリース日を伸ばすのも良くないと思い、version 0.1という位置付けでリリースしました。&lt;/p&gt;

&lt;p&gt;ダウンロードは下のリンクからどうぞ。&lt;/p&gt;

&lt;p&gt;&lt;a href="https://play.google.com/store/apps/details?id=rejasupotaro.rebuild"&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/en_generic_rgb_wo_60.png" alt=""&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;リポジトリはこちら：&lt;a href="https://github.com/rejasupotaro/Rebuild"&gt;rejasupotaro / Rebuild&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;開発の裏話は別の記事にしました：&lt;a href="http://rejasupotaro.github.io/2014/02/18/38.html"&gt;Rebuild.fmクライアント(非公式)開発の裏話&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;どうぞよろしくお願いします。&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>How to build a career through github activities</title>
    <link rel="alternate" href="http://rejasupotaro.github.io/2014/02/11/36.html"/>
    <id>http://rejasupotaro.github.io/2014/02/11/36.html</id>
    <published>2014-02-11T00:00:00+09:00</published>
    <updated>2014-02-12T14:15:38+09:00</updated>
    <author>
      <name>rejasupotaro</name>
    </author>
    <content type="html">&lt;script async class="speakerdeck-embed" data-id="d07deda0755701312eb91a125ab0a9e4" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"&gt;&lt;/script&gt;

&lt;p&gt;&lt;a href="https://github.com/potatotips/potatotips/wiki/potatotips-4"&gt;potatotips-4&lt;/a&gt; で自分が作ったライブラリをどうやって使ってもらうかという話をしました。
元ネタはninjinkunさんの&lt;a href="http://www.slideshare.net/ninjinkun/i-os-30692824"&gt;GitHub活動を通して個人のキャリアを積みつつ仕事の成果を出す方法&lt;/a&gt;です。
持ち時間が5分だったので、時間の都合上端折った箇所を補足します。&lt;/p&gt;

&lt;h1&gt;1. 試しやすくする&lt;/h1&gt;

&lt;h3&gt;サンプルアプリを付ける　&lt;/h3&gt;

&lt;p&gt;サンプルがあるとどういう動きをするのか実際にさわって分かるというのと、それ自体がドキュメントとしての役割を持つので、ライブラリ導入のハードルを下げると思います。
それと、ライブラリを開発しているときも一旦どこかにデプロイして〜とかしなくてもよくなるので、開発スピードが上がります。&lt;/p&gt;

&lt;h1&gt;2. 組み込みやすくする&lt;/h1&gt;

&lt;p&gt;いざ自分のプロジェクトにライブラリを入れようと思ったときに、インストールの仕方が書いてないとアッアッとなります。
そこで開発者が離れていってしまうのはもったいないので、インストール手順は書いた方がいいです。&lt;/p&gt;

&lt;h3&gt;githubにrepositoryとして使う&lt;/h3&gt;

&lt;p&gt;maven-metadata.xmlとファイルの実体さえあえば、どこでもmavenリポジトリにすることができます。
gradleの例ですが、以下のような記述を &lt;code&gt;projectDir/build.gradle&lt;/code&gt; に追加して、&lt;/p&gt;

&lt;pre&gt;&lt;code class="groovy"&gt;apply plugin: &amp;#39;android-library&amp;#39;
apply plugin: &amp;#39;maven&amp;#39;

uploadArchives {
    repositories {
        mavenDeployer {
            repository url: &amp;quot;file://${projectDir}/repository&amp;quot;
            pom.groupId = &amp;#39;rejasupotaro&amp;#39;
            pom.artifactId = &amp;#39;my-library&amp;#39;
            pom.version = &amp;#39;0.0.1&amp;#39;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;コマンドを実行すると、&lt;/p&gt;

&lt;pre&gt;&lt;code class="sh"&gt;$ gradle uploadArchives
$ tree repository
repository
└── rejasupotaro
    └── my-library
        ├── 0.0.1
        │   ├── my-library-0.0.1.aar
        │   ├── my-library-0.0.1.aar.md5
        │   ├── my-library-0.0.1.aar.sha1
        │   ├── my-library-0.0.1.pom
        │   ├── my-library-0.0.1.pom.md5
        │   └── my-library-0.0.1.pom.sha1
        ├── maven-metadata.xml
        ├── maven-metadata.xml.md5
        └── maven-metadata.xml.sha1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;このようになります。
これをコミットしてプッシュします。&lt;/p&gt;

&lt;h3&gt;github上のrepositoryからdependencyを解決する&lt;/h3&gt;

&lt;p&gt;githubのファイルには &lt;code&gt;raw.github.com&lt;/code&gt; でアクセスできるので、repositoriesにgithubのurlを指定して、dependenciesに追加すれば、ライブラリを使うことができるようになります。&lt;/p&gt;

&lt;pre&gt;&lt;code class="groovy"&gt;repositories {
    ...
    maven { url &amp;#39;https://raw.github.com/rejasupotaro/MyLibrary/master/library/repository&amp;#39; }
}

dependencies {
    ...
    compile &amp;#39;rejasupotaro:my-library:0.0.1&amp;#39;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;ローカルでjarにする&lt;/h2&gt;

&lt;p&gt;リソースもいらないし手元で、jarに出来ればよいという場合には、以下のようにすればいいと思います。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apply plugin: &amp;#39;java&amp;#39;

group = &amp;#39;rejasupotaro&amp;#39;
archivesBaseName = &amp;#39;my-library&amp;#39;
version = &amp;#39;0.0.1&amp;#39;

sourceSets {
    main {
        java {
            srcDir &amp;#39;src/main/java&amp;#39;
        }
    }
}

dependencies {
    compile fileTree(dir: &amp;#39;libs&amp;#39;, include: &amp;#39;*.jar&amp;#39;)
}

task sourcesJar(type: Jar) {
    classifier = &amp;#39;sources&amp;#39;
    from sourceSets.main.allSource
}

artifacts {
    archives sourcesJar
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;$ gradle jar&lt;/code&gt; を実行すると &lt;code&gt;src/main/java&lt;/code&gt; 以下のclassファイルとManifestのarchive(jar)が作成されます。&lt;/p&gt;

&lt;p&gt;pluginが他のプラグインとぶつかるときは、環境変数で切り替えたりしています。
たとえばjarを作るときはリリース時なので &lt;code&gt;$ gradle jar -Penv=release&lt;/code&gt; みたいな。&lt;/p&gt;

&lt;h1&gt;3. 品質を高める&lt;/h1&gt;

&lt;p&gt;テストをどう書くか、という話はここではしませんが、少なくともテストのないライブラリは積極的に使おうという気にはならないですよね。
テストに加えて、CIが通ったバッチがREADMEについてると、なお安心感があります。&lt;/p&gt;

&lt;p&gt;どのCIサービスを使うかという話ですが、好みがあると思いますが、僕は一応Wercker推しです。
以下、非常に偏った比較です。&lt;/p&gt;

&lt;h3&gt;Wercker&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;何も書かなくてもデフォルトのビルドファイルを適用してくれる&lt;/li&gt;
&lt;li&gt;あらかじめビルド環境(Box)が用意されている&lt;/li&gt;
&lt;li&gt;&lt;a href="https://github.com/wercker/box-android"&gt;wercker / box-android&lt;/a&gt;が公開されてる&lt;/li&gt;
&lt;li&gt;submoduleを自動で取ってきてくれる&lt;/li&gt;
&lt;li&gt;あと何秒みたいなのが表示されたり、グラフィカルなBuild Statsがあったり、UIが洗練されている&lt;/li&gt;
&lt;li&gt;ビルドがTravisと比べて速い&lt;/li&gt;
&lt;li&gt;ログはリアルタイムに更新されない&lt;/li&gt;
&lt;li&gt;デプロイまで面倒を見てくれる&lt;/li&gt;
&lt;li&gt;まだβ版なので今後どうなるかは分からない&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;Circle CI&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;ちょっと洗練されたTravis(イメージ)&lt;/li&gt;
&lt;li&gt;結構ビジネスって使ってるって聞きます&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;Travis&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;個人の開発者とか、OSSで一番よく使われている&lt;/li&gt;
&lt;li&gt;最初は設定が面倒だけど、一度設定すれば設定ファイルをコピペでいける&lt;/li&gt;
&lt;/ul&gt;

&lt;h3&gt;サーバーのセットアップ&lt;/h3&gt;

&lt;p&gt;社内のAndroidのビルド環境のセットアップを丹精込めて手作業で行なってきたけど、最近物忘れが激しくて &lt;code&gt;android…update…filter…?no-ui…???&lt;/code&gt; みたいにコマンドがうろ覚え状態ということもあり、CIサーバーのセットアップを自動化できないかと思って流行りのchefとかfabricとかserverspecとかを使ってみたけど、&lt;a href="https://github.com/embarkmobile/android-sdk-installer"&gt;android-sdk-installer&lt;/a&gt;を使うというところに落ち着きました。&lt;/p&gt;

&lt;p&gt;これのいいところは、Travisを使っている人は分かると思いますが、毎回 &lt;code&gt;wait_for_emulator&lt;/code&gt; をコピペしていたのが、ツールの中に入ってるのが良かったです。&lt;/p&gt;

&lt;h1&gt;4. 表現を工夫する&lt;/h1&gt;

&lt;p&gt;UIのライブラリはgifアニメがあるだけで印象がだいぶ変わります。
あとライセンスがREADMEに書いてあるものも、僕的にポイント高いです。&lt;/p&gt;

&lt;p&gt;&lt;img height="200" src="https://github-camo.global.ssl.fastly.net/d20ac6fb1cb14db4b69ab5e48ebd609aab1f6831/687474703a2f2f6f70656e61706869642e6769746875622e636f6d2f696d616765732f666c6970766965772d686f72697a6f6e74616c2d64656d6f2e676966"&gt;
&lt;img height="200" src="http://gifzo.net/jTEl4YmZqD.gif"&gt;
&lt;img height="200" src="http://gifzo.net/BWvNCrQFYfF.gif"&gt;
&lt;img height="200" src="http://gifzo.net/68NrYQW2tB.gif"&gt;
&lt;img height="200" src="http://gifzo.net/lSwyh4fg6P.gif"&gt;
&lt;img height="200" src="http://gifzo.net/OKyqq1D9yD.gif"&gt;&lt;/p&gt;

&lt;p&gt;みたいな。&lt;/p&gt;

&lt;h1&gt;5. 広報&lt;/h1&gt;

&lt;p&gt;READMEはインストール方法とか、ライブラリの使い方とかしか書けないけど、ブログならどういう問題があって、どういうアプローチで解決したかみたいな背景も書けるので、そういうのを知ると使ってみようかなっていう気になるし、それに拡散できるのでよいです。&lt;/p&gt;

&lt;h1&gt;おわりに&lt;/h1&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/activities.png" alt=""&gt;
&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/aizen.png" alt=""&gt;&lt;/p&gt;
</content>
  </entry>
  <entry>
    <title>KinMozaView is updated!!</title>
    <link rel="alternate" href="http://rejasupotaro.github.io/2014/02/09/35.html"/>
    <id>http://rejasupotaro.github.io/2014/02/09/35.html</id>
    <published>2014-02-09T00:00:00+09:00</published>
    <updated>2014-02-12T14:14:50+09:00</updated>
    <author>
      <name>rejasupotaro</name>
    </author>
    <content type="html">&lt;h2&gt;きんモザビューワーをアップデートしました！&lt;/h2&gt;

&lt;p&gt;&lt;img src="https://github.com/rejasupotaro/KinMozaViewer/blob/master/screenshot.png?raw=true" alt=""&gt;&lt;/p&gt;

&lt;h2&gt;主な変更点は2点！&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;自動再生機能を追加しました！&lt;/li&gt;
&lt;li&gt;再生中に画面をスリープしないようにしました！&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src="https://github.com/rejasupotaro/KinMozaViewer/blob/master/screenshot.png?raw=true" alt=""&gt;&lt;/p&gt;

&lt;p&gt;ダウンロード(というかビルド)は&lt;a href="https://github.com/rejasupotaro/KinMozaViewer"&gt;GitHub&lt;/a&gt;からどうぞ！&lt;/p&gt;

&lt;p&gt;&lt;a href="http://rejasupotaro.github.io/2013/10/31/8.html"&gt;リリースしたときに書いたブログ&lt;/a&gt;はリンクを貼っただけだったので、ちょっと技術的な話をします。&lt;/p&gt;

&lt;h2&gt;gifの表示について&lt;/h2&gt;

&lt;p&gt;表示しているgifは&lt;a href="http://mogashi.hateblo.jp/entry/2013/09/24/000619"&gt;APIで取得している&lt;/a&gt;のですが、Androidでgifを表示するにはかなり頑張らないといけないので、WebViewで表示するようにしました。&lt;/p&gt;

&lt;p&gt;assetsにテンプレートを置いておいて、APIで取得したURLと動的に取得した画面幅を組み込んで、loadDataWithBaseURLでコンテンツをWebViewに流しています。&lt;/p&gt;

&lt;pre&gt;&lt;code class="java"&gt;String imageUrl = UrlUtils.buildAliceUrl(ep, no);
String content = mTemplate.compile(imageUrl);
loadDataWithBaseURL(&amp;quot;&amp;quot;, content, &amp;quot;text/html&amp;quot;, HTTP.UTF_8, null);
&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;自動再生について&lt;/h2&gt;

&lt;p&gt;一定時間おきにタスクを実行するコードをよく書く気がしたので、汎用的なクラスを作りました。
コンストラクタにRunnableとインターバル値を入れます。&lt;/p&gt;

&lt;pre&gt;&lt;code class="java"&gt;public class PeriodicTimerTask {

    private Handler mHandler = new Handler();

    private Runnable mTask;

    private int mTaskIntervalMs;

    private TimerTask mTimerTask;

    private Timer mTimer;

    private TimerTask newTimerTask() {
        return new TimerTask() {
            @Override
            public void run() {
                mHandler.post(mTask);
            }
        };
    }

    private Timer newTimer() {
        return new Timer(true);
    }

    public PeriodicTimerTask(Runnable task, int taskIntervalMs) {
        mTask = task;
        mTaskIntervalMs = taskIntervalMs;
    }

    public void start() {
        if (mTimer == null) {
            mTimerTask = newTimerTask();
            mTimer = newTimer();
            mTimer.schedule(mTimerTask, 0, mTaskIntervalMs);
        }
    }

    public void stop() {
        if (mTimer != null) {
            mTimer.cancel();
            mTimer = null;
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;たとえばこのアプリでは、自動再生モードがオンのとき、SeekBarを一定時間おきに動かしています。&lt;/p&gt;

&lt;pre&gt;&lt;code class="java"&gt;public class MediaTimerTask extends PeriodicTimerTask {

    private static final int TASK_INTERVAL_MS = 500;

    private static final int PROGRESS_INCREMENT = 10;

    public MediaTimerTask(final SeekBar seekBar) {
        super(new Runnable() {
            @Override
            public void run() {
                if (seekBar == null) {
                    return;
                }

                int progress = seekBar.getProgress();
                if (progress &amp;gt;= seekBar.getMax()) {
                    progress = 0;
                } else {
                    progress += PROGRESS_INCREMENT;
                }
                seekBar.setProgress(progress);
            }
        }, TASK_INTERVAL_MS);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;SeekBarでは進捗(Progress)に変化があったときに、進捗値から何章のどこら辺かを計算して、そのパラメータを付けてAPIを叩いて、画面を更新します。&lt;/p&gt;

&lt;h2&gt;アプリをスリープさせない&lt;/h2&gt;

&lt;p&gt;MainActivityのonCreate相当のところで下のような処理をしています。&lt;/p&gt;

&lt;pre&gt;&lt;code class="java"&gt;private void keepScreenOn() {
    getWindow().addFlags(WindowManager.LayoutParams.FLAG_KEEP_SCREEN_ON);
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;アイコンを作る&lt;/h2&gt;

&lt;p&gt;アイコンを作るのに&lt;a href="http://android-ui-utils.googlecode.com/hg/asset-studio/dist/index.html"&gt;Android Asset Studio&lt;/a&gt;を使おうとするんだけど、Android Asset Studioだと角丸ができないので、調べたら&lt;a href="http://www.gieson.com/Library/projects/utilities/icon_slayer/"&gt;Icon Slayer&lt;/a&gt;っていうのが出てきて、それを使っています。&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/icon_generator.png" alt=""&gt;&lt;/p&gt;

&lt;h2&gt;効果的な使用方法&lt;/h2&gt;

&lt;p&gt;手元のAndroid搭載プロジェクタにこのアプリを入れて、部屋を暗くしてコードを書いてる後ろでエンドレスで再生し続けます。&lt;/p&gt;

&lt;p&gt;&lt;img src="https://dl.dropboxusercontent.com/u/54255753/blog/201402/projector.png" alt=""&gt;&lt;/p&gt;

&lt;p&gt;6畳に物が散乱している狭い部屋を、生ぬるいくらいの温度にして、プロジェクタとノートPCの光だけが部屋を照らしている中、寝落ちするまでコードを書く。
よく分からないけどこの生活が癖になってしまって、とにかく昼間眠い。&lt;/p&gt;

&lt;p&gt;&lt;img src="https://github.com/rejasupotaro/KinMozaViewer/blob/master/screenshot.png?raw=true" alt=""&gt;&lt;/p&gt;
</content>
  </entry>
</feed>
